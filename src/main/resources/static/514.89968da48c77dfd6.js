"use strict";(self.webpackChunkamued_frontend=self.webpackChunkamued_frontend||[]).push([[514],{5514:(z,h,s)=>{s.r(h),s.d(h,{AddContributionComponent:()=>T});var l=s(4341),g=s(177),C=s(3888),F=s(9974),x=s(4360),M=s(3294),o=s(4438),k=s(3076),O=s(5794),y=s(2308),E=s(3587),v=s(1626),A=s(5031);let N=(()=>{class e{constructor(n,r){this.httpClient=n,this.appState=r,this.url=E.c.API_URL}getContribute(n,r,t){let i={headers:(new v.Lr).set("Content-Type","application/json")};return this.httpClient.post(`${this.url}/contribution/contribute-phone`,{phoneNumber:n,monthId:r,sessionId:t},i)}static{this.\u0275fac=function(r){return new(r||e)(o.KVO(v.Qq),o.KVO(A.i))}}static{this.\u0275prov=o.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();const p=e=>({"is-invalid":e});function w(e,a){1&e&&(o.j41(0,"div",25),o.nrm(1,"i",26),o.EFF(2," Veuillez saisir un num\xe9ro de t\xe9l\xe9phone valide (9 chiffres). "),o.k0s())}function j(e,a){if(1&e&&(o.j41(0,"option",27),o.EFF(1),o.k0s()),2&e){const n=a.$implicit;o.Y8G("value",n.id),o.R7$(),o.JRh(n.session)}}function S(e,a){1&e&&(o.j41(0,"div",25),o.nrm(1,"i",26),o.EFF(2," Veuillez s\xe9lectionner une session. "),o.k0s())}function _(e,a){if(1&e&&(o.j41(0,"option",27),o.EFF(1),o.k0s()),2&e){const n=a.$implicit;o.Y8G("value",n.id),o.R7$(),o.JRh(n.monthName)}}function I(e,a){1&e&&(o.j41(0,"div",25),o.nrm(1,"i",26),o.EFF(2," Veuillez s\xe9lectionner un mois. "),o.k0s())}function R(e,a){1&e&&(o.j41(0,"div",28),o.nrm(1,"i",29),o.EFF(2," Saisir un num\xe9ro pour obtenir le montant. "),o.k0s())}let T=(()=>{class e{constructor(n,r,t,i,u){this.fb=n,this.sessionService=r,this.toaster=t,this.bourseService=i,this.contributionService=u,this.sessions=[],this.months=[],this.memberAmount=null}ngOnInit(){this.contributionForm=this.fb.group({memberPhoneNumber:["",[l.k0.required,l.k0.pattern(/^\d{9}$/)]],session:["",l.k0.required],month:["",l.k0.required],montant:[{value:"",disabled:!0}]}),this.loadSessions(),this.loadMonths(),this.contributionForm.get("memberPhoneNumber")?.valueChanges.pipe(function P(e,a=C.E){return(0,F.N)((n,r)=>{let t=null,i=null,u=null;const m=()=>{if(t){t.unsubscribe(),t=null;const c=i;i=null,r.next(c)}};function b(){const c=u+e,d=a.now();if(d<c)return t=this.schedule(void 0,c-d),void r.add(t);m()}n.subscribe((0,x._)(r,c=>{i=c,u=a.now(),t||(t=a.schedule(b,e),r.add(t))},()=>{m(),r.complete()},void 0,()=>{i=t=null}))})}(400),(0,M.F)()).subscribe(n=>{this.contributionForm.get("memberPhoneNumber")?.valid?this.getMemberContributionAmount(n):(this.memberAmount=null,this.contributionForm.get("montant")?.setValue("Saisir un num\xe9ro valide"))})}loadSessions(){this.sessionService.getCurrentYear().subscribe({next:n=>{this.sessions="Succeeded"===n.result&&n.data?[n.data]:[]},error:()=>this.toaster.error("Erreur lors de la r\xe9cup\xe9ration des sessions. Veuillez r\xe9essayer.")})}loadMonths(){this.sessionService.getMonth().subscribe({next:n=>{this.months="Succeeded"===n.result&&n.data?n.data:[]},error:()=>this.toaster.error("Erreur lors de la r\xe9cup\xe9ration des mois. Veuillez r\xe9essayer.")})}getMemberContributionAmount(n){this.bourseService.getBourseAmount("+221"+n).subscribe({next:t=>{console.log("R\xe9ponse Bourse:",t.data),"OK"===t.status&&null!=t.data?(this.memberAmount=t.data,this.contributionForm.get("montant")?.setValue(this.memberAmount)):(this.memberAmount=null,this.contributionForm.get("montant")?.setValue("Montant non trouv\xe9"),this.toaster.info("Aucun montant de bourse trouv\xe9 pour ce membre."))},error:t=>{this.memberAmount=null,this.contributionForm.get("montant")?.setValue("Erreur de r\xe9cup\xe9ration"),this.toaster.error("Erreur lors de la r\xe9cup\xe9ration du montant de la bourse."),console.error("Erreur BourseService:",t)}})}onSubmit(){if(this.contributionForm.valid&&null!==this.memberAmount){const n="+221"+this.contributionForm.get("memberPhoneNumber")?.value,r=this.contributionForm.get("month")?.value,t=this.contributionForm.get("session")?.value;this.contributionService.getContribute(n,r,t).subscribe({next:i=>{"OK"===i.status&&(this.toaster.success("Cotisation ajout\xe9e avec succ\xe8s !"),this.contributionForm.reset(),this.memberAmount=null,this.contributionForm.get("montant")?.setValue(""),this.contributionForm.get("registrationType")?.setValue("INITIAL"))},error:i=>{console.error("Erreur lors de l'ajout de la cotisation:",i),"ENTITY_ALL_READY_REGISTERED"===i.error?.error?.code?this.toaster.info(i.error.error.message||"Cotisation d\xe9j\xe0 enregistr\xe9e pour ce mois et cette session."):this.toaster.error("\xc9chec de l'ajout de la cotisation. Veuillez r\xe9essayer.")}})}else this.contributionForm.markAllAsTouched(),this.toaster.warning("Veuillez corriger les erreurs dans le formulaire et assurez-vous que le montant du membre est d\xe9fini.")}static{this.\u0275fac=function(r){return new(r||e)(o.rXU(l.ok),o.rXU(k.m),o.rXU(O.tw),o.rXU(y.M),o.rXU(N))}}static{this.\u0275cmp=o.VBU({type:e,selectors:[["app-contribution"]],standalone:!0,features:[o.aNF],decls:44,vars:18,consts:[[1,"contribution-container"],["novalidate","",3,"formGroup"],[1,"card-modern"],[1,"card-body"],[1,"card-title"],[1,"row","gx-4","gy-3"],[1,"col-md-4"],[1,"form-group"],["for","memberPhoneNumber",1,"form-label"],[1,"input-group-custom"],[1,"input-group-text-custom"],["id","memberPhoneNumber","placeholder","Saisir les 9 chiffres","formControlName","memberPhoneNumber",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","session",1,"form-label"],["id","session","formControlName","session",1,"form-control","form-select-custom",3,"ngClass"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","month",1,"form-label"],["id","month","formControlName","month",1,"form-control","form-select-custom",3,"ngClass"],["for","montant",1,"form-label"],["id","montant","formControlName","montant","placeholder","Montant Bourse...",1,"form-control","form-control-readonly",3,"readonly"],["class","text-info mt-1",4,"ngIf"],[1,"d-flex","justify-content-end","mt-5"],["type","button",1,"btn","btn-primary-custom",3,"click","disabled"],[1,"bi","bi-floppy2"],[1,"invalid-feedback"],[1,"bi","bi-exclamation-circle-fill"],[3,"value"],[1,"text-info","mt-1"],[1,"bi","bi-info-circle-fill"]],template:function(r,t){if(1&r&&(o.j41(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"h3",4),o.EFF(5,"Enregistrement des Cotisations"),o.k0s(),o.j41(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),o.EFF(10,"Membre"),o.k0s(),o.j41(11,"div",9)(12,"span",10),o.EFF(13,"+221"),o.k0s(),o.nrm(14,"input",11),o.k0s(),o.DNE(15,w,3,0,"div",12),o.k0s()(),o.j41(16,"div",6)(17,"div",7)(18,"label",13),o.EFF(19,"Session"),o.k0s(),o.j41(20,"select",14)(21,"option",15),o.EFF(22,"S\xe9lectionner une session"),o.k0s(),o.DNE(23,j,2,2,"option",16),o.k0s(),o.DNE(24,S,3,0,"div",12),o.k0s()(),o.j41(25,"div",6)(26,"div",7)(27,"label",17),o.EFF(28,"Mois"),o.k0s(),o.j41(29,"select",18)(30,"option",15),o.EFF(31,"S\xe9lectionner un mois"),o.k0s(),o.DNE(32,_,2,2,"option",16),o.k0s(),o.DNE(33,I,3,0,"div",12),o.k0s()(),o.j41(34,"div",6)(35,"div",7)(36,"label",19),o.EFF(37,"Montant de la bourse"),o.k0s(),o.nrm(38,"input",20),o.DNE(39,R,3,0,"div",21),o.k0s()()()()(),o.j41(40,"div",22)(41,"button",23),o.bIt("click",function(){return t.onSubmit()}),o.nrm(42,"i",24),o.EFF(43," Enregistrer "),o.k0s()()()()),2&r){let i,u,m,b,c,d,f;o.R7$(),o.Y8G("formGroup",t.contributionForm),o.R7$(13),o.Y8G("ngClass",o.eq3(12,p,(null==(i=t.contributionForm.get("memberPhoneNumber"))?null:i.invalid)&&(null==(i=t.contributionForm.get("memberPhoneNumber"))?null:i.touched))),o.R7$(),o.Y8G("ngIf",(null==(u=t.contributionForm.get("memberPhoneNumber"))?null:u.invalid)&&(null==(u=t.contributionForm.get("memberPhoneNumber"))?null:u.touched)),o.R7$(5),o.Y8G("ngClass",o.eq3(14,p,(null==(m=t.contributionForm.get("session"))?null:m.invalid)&&(null==(m=t.contributionForm.get("session"))?null:m.touched))),o.R7$(3),o.Y8G("ngForOf",t.sessions),o.R7$(),o.Y8G("ngIf",(null==(b=t.contributionForm.get("session"))?null:b.invalid)&&(null==(b=t.contributionForm.get("session"))?null:b.touched)),o.R7$(5),o.Y8G("ngClass",o.eq3(16,p,(null==(c=t.contributionForm.get("month"))?null:c.invalid)&&(null==(c=t.contributionForm.get("month"))?null:c.touched))),o.R7$(3),o.Y8G("ngForOf",t.months),o.R7$(),o.Y8G("ngIf",(null==(d=t.contributionForm.get("month"))?null:d.invalid)&&(null==(d=t.contributionForm.get("month"))?null:d.touched)),o.R7$(5),o.Y8G("readonly",!0),o.R7$(),o.Y8G("ngIf",null===t.memberAmount&&(null==(f=t.contributionForm.get("memberPhoneNumber"))?null:f.valid)&&(null==(f=t.contributionForm.get("memberPhoneNumber"))?null:f.dirty)),o.R7$(2),o.Y8G("disabled",t.contributionForm.invalid||null===t.memberAmount)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,l.X1,l.qT,l.xH,l.y7,l.me,l.wz,l.BC,l.cb,l.j4,l.JD],styles:["@charset \"UTF-8\";.contribution-container[_ngcontent-%COMP%]{max-width:1000px;margin:40px auto;padding:20px;background-color:#f8f9fa;border-radius:12px;font-family:Inter,sans-serif;color:#343a40}.card-modern[_ngcontent-%COMP%]{background-color:#fff;border:none;border-radius:12px;box-shadow:0 8px 20px #00000014;overflow:hidden}.card-body[_ngcontent-%COMP%]{padding:40px}.card-title[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:600;color:#007bff;margin-bottom:30px;text-align:center;position:relative}.card-title[_ngcontent-%COMP%]:after{content:\"\";display:block;width:60px;height:4px;background-color:#007bff;margin:10px auto 0;border-radius:2px}.form-group[_ngcontent-%COMP%]{margin-bottom:25px}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#343a40;margin-bottom:8px;display:block}.form-control[_ngcontent-%COMP%]{border:1px solid #e0e0e0;border-radius:8px;padding:12px 15px;font-size:1rem;color:#343a40;transition:all .3s ease-in-out;box-shadow:none}.form-control[_ngcontent-%COMP%]:focus{border-color:#0062cc;box-shadow:0 0 0 .2rem #007bff40;outline:none}.form-control[_ngcontent-%COMP%]::placeholder{color:#6c757d;opacity:.7}.form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545;padding-right:2.25rem;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle r='1' cx='6' cy='8.2'/%3e%3c/svg%3e\");background-repeat:no-repeat;background-position:right calc(.375em + .1875rem) center;background-size:calc(.75em + .375rem) calc(.75em + .375rem)}.invalid-feedback[_ngcontent-%COMP%]{color:#dc3545;font-size:.875rem;margin-top:5px;display:block}.invalid-feedback[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}.input-group-custom[_ngcontent-%COMP%]{display:flex}.input-group-custom[_ngcontent-%COMP%]   .input-group-text-custom[_ngcontent-%COMP%]{background-color:#f8f9fa;border:1px solid #e0e0e0;border-right:none;border-radius:8px 0 0 8px;padding:12px 15px;font-size:1rem;color:#343a40;font-weight:500}.input-group-custom[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-left:none;border-radius:0 8px 8px 0}.input-group-custom[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{border-left:1px solid #0062cc}.input-group-custom[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%]{border-left:1px solid #dc3545}.input-group-custom[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.form-select-custom[_ngcontent-%COMP%]{appearance:none;background-image:url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e\");background-repeat:no-repeat;background-position:right .75rem center;background-size:16px 12px}.form-control-readonly[_ngcontent-%COMP%]{background-color:#f8f9fa;color:#6c757d;cursor:default;opacity:.9}.form-control-readonly[_ngcontent-%COMP%]:focus{box-shadow:none;border-color:#e0e0e0}.btn-primary-custom[_ngcontent-%COMP%]{background-color:#007bff;border-color:#007bff;color:#fff;padding:12px 30px;border-radius:8px;font-size:1rem;font-weight:500;transition:all .3s ease;box-shadow:0 4px 10px #007bff33}.btn-primary-custom[_ngcontent-%COMP%]:hover{background-color:#0062cc;border-color:#0062cc;box-shadow:0 6px 15px #007bff4d;transform:translateY(-2px)}.btn-primary-custom[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;cursor:not-allowed;opacity:.7;box-shadow:none;transform:translateY(0)}.btn-primary-custom[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px;font-size:1.1rem}.text-info[_ngcontent-%COMP%]{font-size:.875rem;color:#007bff}.text-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}@media (max-width: 768px){.card-body[_ngcontent-%COMP%]{padding:25px}.card-title[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:20px}.row.gx-4.gy-3[_ngcontent-%COMP%]{gap:15px 0}.btn-primary-custom[_ngcontent-%COMP%]{width:100%;padding:10px 20px}}"]})}}return e})()}}]);